<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=hapytex data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting." data-color=#e9c012 data-position=Right data-x_margin=18 data-y_margin=18></script><meta name=keywords content="Django,web,programming,antipattern,pattern,troubleshooting,software design,querystring,querydict,percent-encoding,django-templates "><meta name=author content="Willem Van Onsem"><meta name=description content="A set of Django (anti)patterns: patterns and things to avoid when building a web application with Django."><meta name=twitter:image:src content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f"><meta name=og:title content="Passing parameters directly in the query string of a URL"><meta name=og:image content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f"><meta name=og:image:alt content="A prohibition sign in the Django color scheme."><meta name=og:image:type content="image/png"><meta name=og:type content="website"><link rel=stylesheet href=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/template.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/styles/default.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css><script src=https://code.jquery.com/jquery-3.5.1.min.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.cookie.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.hoverIntent.minified.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link href=/style.css rel=stylesheet><link href=https://cdn.rawgit.com/ryangrose/easy-pandoc-templates/948e28e5/css/elegant_bootstrap.css rel=stylesheet><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/jquery.sticky-kit.js></script><script data-ad-client=ca-pub-9962024266760159 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script src=/script.js></script><link rel=icon href=/favicon.ico type=image/x-icon><meta name=generator content="pandoc"><title>Passing parameters directly in the query string of a URL &#8249; antipattern &#8249; Django antipatterns</title>
<link rel=stylesheet href></head><body><a class=github-fork-ribbon href=https://github.com/hapytex/django-antipatterns data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a><div class="navbar navbar-static-top"><div class=navbar-inner><div class=container><nav aria-label=section><ol class=breadcrumb><li class=breadcrumb-item><a href=/><i class="fas fa-home"></i></a><li class=breadcrumb-item><a href=/antipattern.html><i class="fas fa-ban"></i>&nbsp;
antipattern</a><li class="breadcrumb-item active" aria-current=page>Passing parameters directly in the query string of a URL</ol></nav><ul class="nav pull-right doc-info"><li><div class=rating data-rating=3>severity:
<i class=star-1>★</i>
<i class=star-2>★</i>
<i class=star-3>★</i>
<i class=star-4>★</i>
<i class=star-5>★</i></div></ul></div></div></div><article><div class=container><div class=row><div class=span12><p>In many templates variables are passed to the <a href=https://en.wikipedia.org/wiki/Query_string><em>query string</em> <sup>[wiki]</sup></a> in a URL, for example:<pre class=django><code>&lt;a href=&quot;?search={{ <b>search</b> }}&amp;page={{ result.next_page_number }}&quot;&gt;&lt;/a&gt;</code></pre><h1 id=why-is-it-a-problem>Why is it a problem?</h1><p>The <code>search</code> variable in this case might contain special characters, for example one could search for a string with a question mark (<code>?</code>) and/or ampersand (<code>&</code>). If we work then with<code>foo&amp;bar=qux</code> as value for <code>{{ search }}</code>. If we directly print this in the URL, then the URL now looks like <code>?search=foo&amp;amp;bar=qux&amp;page=2</code>. This is definitely not what is intended, and Django will parse this as:<pre class=pycon><code>&gt;&gt;&gt; QueryDict(&#39;search=foo&amp;amp;bar=qux&amp;page=2&#39;)
&lt;QueryDict: {&#39;search&#39;: [&#39;foo&#39;], &#39;amp&#39;: [&#39;&#39;], &#39;bar&#39;: [&#39;qux&#39;], &#39;page&#39;: [&#39;2&#39;]}&gt;</code></pre><p>This thus means that we no longer look for <code>foo&amp;bar</code>, but for <code>foo</code>, and it furthermore creates an extra number of items.<p>If <code>search</code> contains a hash character (<code>#</code>), then this acts as the separator between the <em>query string</em> and the <em>fragment</em> of the URL. If we for example search for <code>foo#bar</code>, then we will retrieve <code>?query=foo#bar&amp;page=2</code>, but the part after the hash <code>#</code> will be considered the separator of the querystring with the fragment. For example:<pre class=pycon><code>&gt;&gt;&gt; urlparse(&#39;?search=foo#bar=qux&amp;amp;page=2&#39;)
ParseResult(scheme=&#39;&#39;, netloc=&#39;&#39;, path=&#39;&#39;, params=&#39;&#39;, query=&#39;search=foo&#39;, fragment=&#39;bar=qux&amp;amp;page=2&#39;)</code></pre><p>so <code>request.GET</code> will only have one item: with as key <code>search</code> and as value <code>foo</code>, the rest will not be interpreted by the server.<h1 id=what-can-be-done-to-resolve-the-problem>What can be done to resolve the problem?</h1><p>One can make use of the <a href=https://docs.djangoproject.com/en/dev/ref/templates/builtins/#urlencode><strong><code>|urlencode</code></strong> template filter <sup>[Django-doc]</sup></a> that will percentage encode the values. This means that for <code>foo&amp;bar=qux</code>, we get <code>?query=foo%26bar%3Dqux&amp;page=2</code>, and for <code>foo#bar</code> we get <code>?query=foo%23bar&amp;page=2</code>. These are then converted to:<pre class=pycon><code>&gt;&gt;&gt; QueryDict(&#39;query=foo%26bar%3Dqux&amp;page=2&#39;)
&lt;QueryDict: {&#39;query&#39;: [&#39;foo&amp;bar=qux&#39;], &#39;page&#39;: [&#39;2&#39;]}&gt;
&gt;&gt;&gt; QueryDict(&#39;query=foo%23bar&#39;)
&lt;QueryDict: {&#39;query&#39;: [&#39;foo#bar&#39;]}&gt;</code></pre><p>Django will thus interpret the boundary tokens between the items of the querystring, and the querystring with the fragment correctly and automatically percentage <em>decode</em> the items.<p>We thus should render this as:<pre class=django><code>&lt;a href=&quot;?search={{ search<b>|urlencode</b> }}&amp;page={{ result.next_page_number }}&quot;&gt;&lt;/a&gt;</code></pre></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js integrity="sha512-zPB79j2C+3sFS9zcA3vg/z6bVKzJVEyu9pY5w89akQRys76zpAT2t6S3wZKla3QQ14O5l/Yt0RUQ/DHXx82Y5g==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>anchors.options={placement:"left",visible:"hover",icon:"¶"},anchors.add("h1,h2,h3")</script></article></body></html>