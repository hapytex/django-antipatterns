<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=hapytex data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting." data-color=#e9c012 data-position=Right data-x_margin=18 data-y_margin=18></script><meta name=keywords content="Django,web,programming,antipattern,pattern,troubleshooting,software design,filter,template,database-query,views,django-views,django-templates "><meta name=author content="Willem Van Onsem"><meta name=description content="A set of Django (anti)patterns: patterns and things to avoid when building a web application with Django."><meta name=twitter:image:src content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f"><meta name=og:title content="Filtering in the template"><meta name=og:image content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f"><meta name=og:image:alt content="A prohibition sign in the Django color scheme."><meta name=og:image:type content="image/png"><meta name=og:type content="website"><link rel=stylesheet href=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/template.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/styles/default.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css><script src=https://code.jquery.com/jquery-3.5.1.min.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.cookie.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.hoverIntent.minified.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link href=/style.css rel=stylesheet><link href=https://cdn.rawgit.com/ryangrose/easy-pandoc-templates/948e28e5/css/elegant_bootstrap.css rel=stylesheet><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/jquery.sticky-kit.js></script><script data-ad-client=ca-pub-9962024266760159 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script src=/script.js></script><link rel=icon href=/favicon.ico type=image/x-icon><meta name=generator content="pandoc"><title>Filtering in the template &#8249; antipattern &#8249; Django antipatterns</title>
<link rel=stylesheet href></head><body><a class=github-fork-ribbon href=https://github.com/hapytex/django-antipatterns data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a><div class="navbar navbar-static-top"><div class=navbar-inner><div class=container><nav aria-label=section><ol class=breadcrumb><li class=breadcrumb-item><a href=/><i class="fas fa-home"></i></a><li class=breadcrumb-item><a href=/antipattern.html><i class="fas fa-ban"></i>&nbsp;
antipattern</a><li class="breadcrumb-item active" aria-current=page>Filtering in the template</ol></nav><ul class="nav pull-right doc-info"><li><div class=rating data-rating=3>severity:
<i class=star-1>★</i>
<i class=star-2>★</i>
<i class=star-3>★</i>
<i class=star-4>★</i>
<i class=star-5>★</i></div></ul></div></div></div><article><div class=container><div class=row><div class=span12><p>Instead of filtering data in the view, we can filter data in the template. For example with:<pre class=django><code>{% for product in products %}
    {% if <b>product.is_active</b> %}
        {{ product.name }}
    {% endif %}
{% endfor %}</code></pre><p>Here we thus enumerate over the products in <code>product</code>, check if it is an active product, and only then we render the <code>.name</code> of the <code>product</code>.<h1 id=why-is-it-a-problem>Why is it a problem?</h1><p>Templates should not be concerned with <em>business logic</em>, they should only implement <em>rendering</em> logic. Templates thus try to let data look pleasant on the screen, but they should not decide what that data is, that is the responsibility of the <em>view</em>.<p>It is less efficient to let the template do this. It means that you first load all <code>Product</code>s into memory, pass these to the template, and then the template will have to decide what to render or not. The template engine is not that fast, and could thus easily go into timeout if the number of products is large.<p>One often filters on related models as well, for example:<pre class=django><code>{% for product in products %}
    {% if <b>product.category.is_active</b> %}
        {{ product.name }}
    {% endif %}
{% endfor %}</code></pre><p>This will make extra queries in the template, and thus turn into a <em>N+1</em> problem.<h1 id=what-can-be-done-to-resolve-the-problem>What can be done to resolve the problem?</h1><p>One should filter in the <em>view</em>. Django's ORM makes filtering easier and more efficient. the filtering is done at the <em>database side</em>, and a database is designed to do this efficient. It will not generate <em>N+1</em> problems if you filter on related objects, and furthermore it will reduce the bandwidth between the database and the Django/Python layer.<p>Instead of filtering the <code>products</code> in the template, we thus filter in the view:<pre class=python><code>from django.shortcuts import render

def my_view(request):
    # &hellip;
    products = Product.objects.<b>filter(is_active=True)</b>
    # &hellip;
    context = {
        'products': products
    }
    return render(request, <i>'some_template.html'</i>, context)</code></pre><p>then we can render the active products with:<pre class=django><code>{% for product in products %}
    {{ product.name }}
{% endfor %}</code></pre></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js integrity="sha512-zPB79j2C+3sFS9zcA3vg/z6bVKzJVEyu9pY5w89akQRys76zpAT2t6S3wZKla3QQ14O5l/Yt0RUQ/DHXx82Y5g==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>anchors.options={placement:"left",visible:"hover",icon:"¶"},anchors.add("h1,h2,h3")</script></article></body></html>