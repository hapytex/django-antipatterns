<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=hapytex data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting." data-color=#e9c012 data-position=Right data-x_margin=18 data-y_margin=18></script><meta name=keywords content="Django,web,programming,antipattern,pattern,troubleshooting,software design,prefix,modelform,django-views,django-forms "><meta name=author content="Willem Van Onsem"><meta name=description content="A set of Django (anti)patterns: patterns and things to avoid when building a web application with Django."><meta name=twitter:image:src content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f"><meta name=og:title content="Using multiple forms on the same page without prefixing"><meta name=og:image content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f"><meta name=og:image:alt content="A prohibition sign in the Django color scheme."><meta name=og:image:type content="image/png"><meta name=og:type content="website"><link rel=stylesheet href=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/template.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/styles/default.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css><script src=https://code.jquery.com/jquery-3.5.1.min.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.cookie.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.hoverIntent.minified.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link href=/style.css rel=stylesheet><link href=https://cdn.rawgit.com/ryangrose/easy-pandoc-templates/948e28e5/css/elegant_bootstrap.css rel=stylesheet><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/jquery.sticky-kit.js></script><script data-ad-client=ca-pub-9962024266760159 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script src=/script.js></script><link rel=icon href=/favicon.ico type=image/x-icon><meta name=generator content="pandoc"><title>Using multiple forms on the same page without prefixing &#8249; antipattern &#8249; Django antipatterns</title><style>pre>code.sourceCode{white-space:pre;position:relative}pre>code.sourceCode>span{display:inline-block;line-height:1.25}pre>code.sourceCode>span:empty{height:1.2em}.sourceCode{overflow:visible}code.sourceCode>span{color:inherit;text-decoration:inherit}div.sourceCode{margin:1em 0}pre.sourceCode{margin:0}@media screen{div.sourceCode{overflow:auto}}@media print{pre>code.sourceCode{white-space:pre-wrap}pre>code.sourceCode>span{text-indent:-5em;padding-left:5em}}pre.numberSource code{counter-reset:source-line 0}pre.numberSource code>span{position:relative;left:-4em;counter-increment:source-line}pre.numberSource code>span>a:first-child::before{content:counter(source-line);position:relative;left:-1em;text-align:right;vertical-align:baseline;border:none;display:inline-block;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:0 4px;width:4em;color:#aaa}pre.numberSource{margin-left:3em;border-left:1px solid #aaa;padding-left:4px}div.sourceCode{}@media screen{pre>code.sourceCode>span>a:first-child::before{text-decoration:underline}}code span.al{color:red}code span.an{color:green}code span.at{}code span.bu{}code span.cf{color:#00f}code span.ch{color:teal}code span.cn{}code span.co{color:green}code span.cv{color:green}code span.do{color:green}code span.er{color:red;font-weight:700}code span.ex{}code span.im{}code span.in{color:green}code span.kw{color:#00f}code span.op{}code span.ot{color:#ff4000}code span.pp{color:#ff4000}code span.sc{color:teal}code span.ss{color:teal}code span.st{color:teal}code span.va{}code span.vs{color:teal}code span.wa{color:green;font-weight:700}</style><link rel=stylesheet href></head><body><a class=github-fork-ribbon href=https://github.com/hapytex/django-antipatterns data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a><div class="navbar navbar-static-top"><div class=navbar-inner><div class=container><nav aria-label=section><ol class=breadcrumb><li class=breadcrumb-item><a href=/><i class="fas fa-home"></i></a><li class=breadcrumb-item><a href=/antipattern.html><i class="fas fa-ban"></i>&nbsp;
antipattern</a><li class="breadcrumb-item active" aria-current=page>Using multiple forms on the same page without prefixing</ol></nav><ul class="nav pull-right doc-info"><li><div class=rating data-rating=3>severity:
<i class=star-1>★</i>
<i class=star-2>★</i>
<i class=star-3>★</i>
<i class=star-4>★</i>
<i class=star-5>★</i></div></ul></div></div></div><article><div class=container><div class=row><div class=span12><p>Some views do not work with one form, but with <em>multiple</em> forms. In that case it is important to work with prefixes such that the two forms will each process their part of the composite form.<h1 id=why-is-it-a-problem>Why is it a problem?</h1><p>For example one can make two forms to fill in data about the father and the mother with:<div class=sourceCode id=cb1><pre class="sourceCode python"><code class="sourceCode python"><span id=cb1-1><a href=#cb1-1 aria-hidden=true tabindex=-1></a><span class=im>from</span> django <span class=im>import</span> forms</span>
<span id=cb1-2><a href=#cb1-2 aria-hidden=true tabindex=-1></a></span>
<span id=cb1-3><a href=#cb1-3 aria-hidden=true tabindex=-1></a><span class=kw>class</span> FatherForm(forms.Form):</span>
<span id=cb1-4><a href=#cb1-4 aria-hidden=true tabindex=-1></a>    name <span class=op>=</span> forms.CharField()</span>
<span id=cb1-5><a href=#cb1-5 aria-hidden=true tabindex=-1></a>    first_name <span class=op>=</span> forms.CharField()</span>
<span id=cb1-6><a href=#cb1-6 aria-hidden=true tabindex=-1></a></span>
<span id=cb1-7><a href=#cb1-7 aria-hidden=true tabindex=-1></a><span class=kw>class</span> MotherForm(forms.Form):</span>
<span id=cb1-8><a href=#cb1-8 aria-hidden=true tabindex=-1></a>    name <span class=op>=</span> forms.CharField()</span>
<span id=cb1-9><a href=#cb1-9 aria-hidden=true tabindex=-1></a>    first_name <span class=op>=</span> forms.CharField()</span></code></pre></div><p>The view then might be defined as:<pre class=python><code>from django.shortcuts import redirect, render

def some_view(request):
    if request.method == 'POST':
        father_form = <b>FatherForm(</b>request.POST<b>)</b>
        mother_form = <b>MotherForm(</b>request.POST<b>)</b>
        if father_form.is_valid() and mother_form.is_valid():
            # process the data &hellip;
            return redirect('<i>name-of-some-view</i>')
    else:
        father_form = FatherForm()
        mother_form = MotherForm()
    return render(
        request,
        '<i>name-of-some-template.html</i>',
        {'father_form': father_form, 'mother_form': mother_form}
    )</code></pre><p>The problem is that if we process data with this view, the request will post two values for <code>name</code> and two values for <code>first_name</code>. The logic of the <a href=https://docs.djangoproject.com/en/dev/ref/request-response/#django.http.QueryDict><strong><code>QueryDict</code></strong> <sup>[Django-doc]</sup></a> means that if we want to get the value for <code>name</code> and/or <code>first_name</code>; it will use the <em>last</em> value that was defined. This thus means that if we render the forms with:<pre class=django><code>&lt;form method=&quot;POST&quot; action=&quot;{% url 'name-of-some-view' %}&quot;&gt;
    {% csrf_token %}
    {{ <b>father_form</b> }}
    {{ <b>mother_form</b> }}
&lt;/form&gt;</code></pre><p>both the <code>father_form</code> and the <code>mother_form</code> will use data from the form elements of the form of the mother. This is because the request will simply send two values for the <code>name</code> and the <code>first_name</code> item, and the two forms, will both use the last value defined.<h1 id=what-can-be-done-to-resolve-the-problem>What can be done to resolve the problem?</h1><p>Django has a solution for this: it can <em>prefix</em> the name of the form elements with a <a href=https://docs.djangoproject.com/en/dev/ref/forms/api/#django.forms.Form.prefix><strong><code>prefix=…</code></strong> parameter <sup>[Django-doc]</sup></a>. This prefix parameter will add a prefix to all the form input items that arise from that form. For example if we specify <code>prefix='father'</code> for the <code>FatherForm</code>, then the name of the items will be <code>father-name</code>, and <code>father-first_name</code>. This thus means that Django now can process these as part of the <code>FatherForm</code>, and the others as part of the <code>MotherForm</code>.<p>Strictly speaking, for <em>n</em> forms, we can decide to only give <em>n-1</em> a prefix and this will work, but it is likely more elegant that all the <em>n</em> forms have a <em>unique</em> prefix. It is important that the prefixes are unique, since otherwise the same problem will arise.<p>We need to specify the prefix for both the GET and the POST codepath, so that means that the view will look like:<pre class=python><code>from django.shortcuts import redirect, render

def some_view(request):
    if request.method == 'POST':
        father_form = FatherForm(request.POST<b>, prefix='father'</b>)
        mother_form = MotherForm(request.POST<b>, prefix='mother'</b>)
        if father_form.is_valid() and mother_form.is_valid():
            # process the data &hellip;
            return redirect('<i>name-of-some-view</i>')
    else:
        father_form = FatherForm(<b>prefix='father'</b>)
        mother_form = MotherForm(<b>prefix='mother'</b>)
    return render(
        request,
        '<i>name-of-some-template.html</i>',
        {'father_form': father_form, 'mother_form': mother_form}
    )</code></pre><h1 id=extra-tips>Extra tips</h1><p>Django has a <a href=https://docs.djangoproject.com/en/dev/topics/forms/formsets/><strong><code>FormSet</code></strong> class <sup>[Django-doc]</sup></a> to render a (large) collection of forms each with a different prefix, this makes it more easy to route data to the correct form without having to worry about the prefixes oneself.</div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js integrity="sha512-zPB79j2C+3sFS9zcA3vg/z6bVKzJVEyu9pY5w89akQRys76zpAT2t6S3wZKla3QQ14O5l/Yt0RUQ/DHXx82Y5g==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>anchors.options={placement:"left",visible:"hover",icon:"¶"},anchors.add("h1,h2,h3")</script></article></body></html>