<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1"><meta charset=utf-8><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=hapytex data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting." data-color=#e9c012 data-position=Right data-x_margin=18 data-y_margin=18></script><meta name=keywords content="Django,web,programming,antipattern,pattern,troubleshooting,software design,foreignkey,onetoonefield,database,django-models "><meta name=author content="Willem Van Onsem"><meta name=description content="A set of Django (anti)patterns: patterns and things to avoid when building a web application with Django."><meta name=twitter:image:src content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f"><meta name=og:title content="ForeignKey and OneToOneField"><meta name=og:image content="https://repository-images.githubusercontent.com/257009680/7a954900-2f5d-11eb-8d0a-c8af0596107f"><meta name=og:image:alt content="A prohibition sign in the Django color scheme."><meta name=og:image:type content="image/png"><meta name=og:type content="website"><link rel=stylesheet href=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/template.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/styles/default.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css><script src=https://code.jquery.com/jquery-3.5.1.min.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.cookie.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.hoverIntent.minified.js></script><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer><link href=/style.css rel=stylesheet><link href=https://cdn.rawgit.com/ryangrose/easy-pandoc-templates/948e28e5/css/elegant_bootstrap.css rel=stylesheet><script src=https://cdn.rawgit.com/diversen/pandoc-bootstrap-adaptive-template/959c3622/jquery.sticky-kit.js></script><script data-ad-client=ca-pub-9962024266760159 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script src=/script.js></script><link rel=icon href=/favicon.ico type=image/x-icon><meta name=generator content="pandoc"><title>ForeignKey and OneToOneField &#8249; difference-between &#8249; Django antipatterns</title>
<link rel=stylesheet href></head><body><a class=github-fork-ribbon href=https://github.com/hapytex/django-antipatterns data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a><div class="navbar navbar-static-top"><div class=navbar-inner><div class=container><nav aria-label=section><ol class=breadcrumb><li class=breadcrumb-item><a href=/><i class="fas fa-home"></i></a><li class=breadcrumb-item><a href=/difference-between.html><i class="fas fa-adjust"></i>&nbsp;
difference-between</a><li class="breadcrumb-item active" aria-current=page><code>ForeignKey</code> and <code>OneToOneField</code></ol></nav><ul class="nav pull-right doc-info"></ul></div></div></div><article><div class=container><div class=row><div class=span12><p>The Django model field API provides a <a href=https://docs.djangoproject.com/en/dev/ref/models/fields/#foreignkey><strong><code>ForeignKey</code></strong> <sup>[Django-doc]</sup></a> and a <a href=https://docs.djangoproject.com/en/dev/ref/models/fields/#django.db.models.OneToOneField><strong><code>OneToOneField</code></strong> <sup>[Django-doc]</sup></a>. Both fields share most of the same parameters: in fact a <code>OneToOneField</code> is a subclass of a <code>ForeignKey</code>. In the constructor, it sets the <a href=https://docs.djangoproject.com/en/dev/ref/models/fields/#unique><strong><code>unique=…</code></strong> parameter <sup>[Django-doc]</sup></a> to <code>True</code>. If you create a <code>ForeignKey</code> with <code>unique=True</code>, then Django will raise an warning that explains that a <code>OneToOneField</code> is probably more appropriate. The fact that a <code>OneToOneField</code> is unique means thus that for two records, the <code>OneToOneField</code>s can <em>not</em> refer to the same record.<p>As a result if a <code>Profile</code> has a <code>OneToOneField</code> to a <code>User</code> model, it means that two <code>Profile</code>s can not refer to the same <code>User</code>, and thus a <code>User</code> record has <em>at most</em> one related <code>Profile</code>. This is important: it means that if we access the <code>Profile</code>(s) of a <code>User</code> we get zero or one records. As a result the designers of Django specified the <a href=https://docs.djangoproject.com/en/dev/ref/models/fields/#django.db.models.ForeignKey.related_name><strong><code>related_name=…</code></strong> <sup>[Django-doc]</sup></a> of a <code>OneToOneField</code>, not as <code><i>modelname</i>_set</code>, but <code><i>modelname</i></code>. Indeed, you access the <code>Profile</code> that belongs to a <code>User</code> object <code>my_user</code> with <code>my_user.profile</code> (given you do not override the <code>related_name=…</code> parameter). This will look for a <code>Profile</code> object, and returns that object if it can be found, otherwise it raises a <code>RelatedObjectDoesNotExist</code> exception. For a <code>ForeignKey</code>, the default would have been <code>profile_set</code>, and <code>my_user.profile_set</code> is a <a href=https://docs.djangoproject.com/en/dev/ref/models/relations/#django.db.models.fields.related.RelatedManager><strong><code>RelatedManager</code></strong> <sup>[Django-doc]</sup></a>: accessing this attribute would thus never raise an error, and one can then access all the related <code>Profile</code>s with <code>my_user.profile_set.all()</code>.<p>A <code>OneToOneField</code> is also used for inheritance. If one has a <em>concrete</em> model named <code>Vehicle</code>, and a subclass of that model named <code>Car</code>, then Django will add a "hidden" <code>OneToOneField</code> named <code><i>modename</i>_ptr</code> with <code><i>modelname</i></code> the name of the model of the parent in lowercase, so in this case, it will be <code>vehicle_ptr</code>. One might want to provide a field themselves, for example to give this a different name, or to add certain behavior. Therefore a <code>OneToOneField</code> accepts an extra <a href=https://docs.djangoproject.com/en/dev/ref/models/fields/#django.db.models.OneToOneField.parent_link><strong><code>.parent_link=…</code></strong> parameter <sup>[Django-doc]</sup></a> which is a boolean that can be set to <code>True</code> in case the <code>OneToOneField</code> acts as a link to that parent.<p>The <code>OneToOneField</code> often gives the wrong impression that if a model <code>Profile</code> has a <code>OneToOneField</code> to a <code>User</code> model for example, it somehow would guarantee that a user has <em>exactly one</em> <code>Profile</code>. That is not the case: a <code>OneToOneField</code> guarantees, if it is not <code>null=True</code>, that a <code>Profile</code> has exactly <em>one</em> related <code>User</code> model, and a <code>User</code> has <em>at most one</em> related <code>Profile</code>. It thus will <em>not</em> automatically create a <code>Profile</code> object in case a <code>User</code> object is constructed. Perhaps a more appropriate name might have been an <code>OptionalToOneField</code>.<h1 id=summary>Summary</h1><table><thead><tr class=header><th style=text-align:left><th style=text-align:left><code>ForeignKey</code><th style=text-align:left><code>OneToOneField</code><tbody><tr class=odd><td style=text-align:left>relation type<td style=text-align:left>many-to-one<td style=text-align:left>optional-to-one<tr class=even><td style=text-align:left>uniqueness<td style=text-align:left>not unique (unless specified)<td style=text-align:left>always unique<tr class=odd><td style=text-align:left>default <code>related_name</code><td style=text-align:left><code><i>modelname</i>_set</code><td style=text-align:left><code><i>modelname</i></code><tr class=even><td style=text-align:left>related relation<td style=text-align:left><code>RelatedManager</code><td style=text-align:left>trying to fetch the reverse object<tr class=odd><td style=text-align:left>parameters<td style=text-align:left><td style=text-align:left>extra <code>parent_link=…</code></table></div></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.1/anchor.min.js integrity="sha512-zPB79j2C+3sFS9zcA3vg/z6bVKzJVEyu9pY5w89akQRys76zpAT2t6S3wZKla3QQ14O5l/Yt0RUQ/DHXx82Y5g==" crossorigin=anonymous referrerpolicy=no-referrer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.3.2/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script>anchors.options={placement:"left",visible:"hover",icon:"¶"},anchors.add("h1,h2,h3")</script></article></body></html>